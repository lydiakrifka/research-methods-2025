function BlueMoodleOnload(){var r=window.location.href.toLowerCase(),f,n,o,s,l,t,a,u,h,c,e;if((localStorage.getItem(BLUE_MOODLE.localConstant.IS_USER_LOGEDIN_MOODLE)==null||localStorage.getItem(BLUE_MOODLE.localConstant.IS_USER_LOGEDIN_MOODLE)=="null"||localStorage.getItem(BLUE_MOODLE.localConstant.IS_USER_LOGEDIN_MOODLE)==undefined)&&r.indexOf("login/index.php")==-1&&r.indexOf("login.php")==-1){if(f=!1,o=document.getElementsByClassName("logininfo"),o!=null&&o!="")for(i=0;i<o.length;i++)if(s=o[i].getElementsByTagName("a"),s!=null&&s!="")for(j=0;j<s.length;j++)if(l=s[j].href,l.indexOf("profile")>-1){n=l.split("=")[1];localStorage.setItem(BLUE_MOODLE.localConstant.USER_DETAILS_MOODLE,n);f=!0;break}if(!f&&(t=document.querySelectorAll("a[href*='profile.php']"),t!=null&&t.length>0))for(i=0;i<t.length;i++)if(t[i].href!=null&&t[i].href!=""&&(n=BLUE_MOODLE.getQueryString("id",t[i].href),n!=null&&n!="")){localStorage.setItem(BLUE_MOODLE.localConstant.USER_DETAILS_MOODLE,n);f=!0;break}if(!f&&(t=document.querySelectorAll("*[data-userid]"),t!=null&&t.length>0))for(i=0;i<t.length;i++)if(n=t[i].getAttribute("data-userid"),n!=null&&n!=""){localStorage.setItem(BLUE_MOODLE.localConstant.USER_DETAILS_MOODLE,n);f=!0;break}f&&n!=null&&n!=""&&n!=undefined?(localStorage.setItem(BLUE_MOODLE.localConstant.IS_USER_LOGEDIN_MOODLE,!0),a=document.getElementsByTagName("html")[0].getAttribute("lang"),u=new XMLHttpRequest,u.onreadystatechange=function(){var t,i;u.readyState==4&&u.status==200&&(t=JSON.parse(u.response),t.MoodleCustomAdminSettingDetails!=null&&localStorage.setItem(BLUE_MOODLE.localConstant.CUSTOM_SETTINGS_DETAILS_MOODLE,JSON.stringify(t.MoodleCustomAdminSettingDetails)),i=BLUE_MOODLE.GetAdminSettingFromLocal(),i!=null&&BLUE_MOODLE.GetTasksForLoginPopup(n,a))},u.open("GET",BLUE_MOODLE_SETUP.appAPI+"/api/Moodle/GetBlueAdminSetting?userId="+n+"&language="+a+"&isLoginPopup=true",!0),u.setRequestHeader("Accept","application/json"),u.setRequestHeader("CONSUMERID",BLUE_MOODLE_SETUP.consumerID),u.send()):BLUE_MOODLE.ClearLocalStorage()}r.indexOf("/course/view.php?id=")>-1||r.indexOf("/mod/lti/view.php?id=")>-1||r.indexOf("/user/view.php?id=")>-1||r.indexOf("/course/user.php?mode=grade")>-1?(e=BLUE_MOODLE.GetAdminSettingFromLocal(),h=r.indexOf("/user/view.php?id=")>-1?BLUE_MOODLE.getParameter("course"):BLUE_MOODLE.getParameter("id"),e!=null&&e.GradeCourseBlockType=="CB"&&(localStorage.getItem(BLUE_MOODLE.localConstant.CURRENT_COURSEORTOOL_ID_MOODLE)==undefined||localStorage.getItem(BLUE_MOODLE.localConstant.CURRENT_COURSEORTOOL_ID_MOODLE)==null||localStorage.getItem(BLUE_MOODLE.localConstant.CURRENT_COURSEORTOOL_ID_MOODLE)==""?localStorage.setItem(BLUE_MOODLE.localConstant.CURRENT_COURSEORTOOL_ID_MOODLE,h):h!=localStorage.getItem(BLUE_MOODLE.localConstant.CURRENT_COURSEORTOOL_ID_MOODLE)&&(localStorage.removeItem(BLUE_MOODLE.localConstant.COURSE_BLOCKPOPUP_MOODLE),localStorage.removeItem(BLUE_MOODLE.localConstant.USER_IN_COURSE_MOODLE),localStorage.setItem(BLUE_MOODLE.localConstant.CURRENT_COURSEORTOOL_ID_MOODLE,h)),localStorage.getItem(BLUE_MOODLE.localConstant.COURSE_BLOCKPOPUP_MOODLE)==undefined||localStorage.getItem(BLUE_MOODLE.localConstant.COURSE_BLOCKPOPUP_MOODLE)==null||localStorage.getItem(BLUE_MOODLE.localConstant.COURSE_BLOCKPOPUP_MOODLE)==""?(localStorage.getItem(BLUE_MOODLE.localConstant.USER_IN_COURSE_MOODLE)==undefined||localStorage.getItem(BLUE_MOODLE.localConstant.USER_IN_COURSE_MOODLE)==null||localStorage.getItem(BLUE_MOODLE.localConstant.USER_IN_COURSE_MOODLE)=="")&&(localStorage.setItem(BLUE_MOODLE.localConstant.USER_IN_COURSE_MOODLE,!0),c=BLUE_MOODLE.CreateCourseBlockPopup(h),localStorage.setItem(BLUE_MOODLE.localConstant.COURSE_BLOCKPOPUP_MOODLE,c),(r.indexOf("/course/view.php?id=")>-1||r.indexOf("/user/view.php?id=")>-1||r.indexOf("/course/user.php?mode=grade")>-1)&&c!=""&&(BLUE_MOODLE.AppendHtmlToBody(c),BLUE_MOODLE.AddLogoutEvents()),c!=""&&BLUE_MOODLE.BlockOtherLinksInCourse()):(BLUE_MOODLE.BlockOtherLinksInCourse(),BLUE_MOODLE.DisableOnClickInternal(!0)),BLUE_MOODLE.BlockHomepageCourses())):(localStorage.getItem(BLUE_MOODLE.localConstant.IS_USER_LOGEDIN_MOODLE)!=null&&localStorage.getItem(BLUE_MOODLE.localConstant.IS_USER_LOGEDIN_MOODLE)!=""&&(e=BLUE_MOODLE.GetAdminSettingFromLocal(),e!=null&&e.GradeCourseBlockType=="CB"&&BLUE_MOODLE.BlockHomepageCourses()),localStorage.removeItem(BLUE_MOODLE.localConstant.COURSE_BLOCKPOPUP_MOODLE),localStorage.removeItem(BLUE_MOODLE.localConstant.USER_IN_COURSE_MOODLE),localStorage.removeItem(BLUE_MOODLE.localConstant.CURRENT_COURSEORTOOL_ID_MOODLE));BLUE_MOODLE.AddLogoutEvents()}var BLUE_MOODLE={localConstant:{IS_USER_LOGEDIN_MOODLE:"isUserLoggedInMoodle",COURSE_TASK_LIST_MOODLE:"courseTaskListMoodle",COURSE_DETAILS_MOODLE:"courseDetailsMoodle",CUSTOM_SETTINGS_DETAILS_MOODLE:"customSettingsDetailsMoodle",USER_DETAILS_MOODLE:"userDetailsMoodle",COURSE_BLOCKPOPUP_MOODLE:"courseBlockPopupMoodle",COURSE_TOOLDETAIL_LIST_MOODLE:"courseToolDetailListMoodle",CURRENT_COURSEORTOOL_ID_MOODLE:"currentcCourseOrToolIdMoodle",USER_IN_COURSE_MOODLE:"userInCourseMoodle",CURRENT_COURSEID_MOODLE:"currentCourseIdMoodle",DATE_FORMAT:{year:"numeric",month:"long",day:"numeric"},BLOCKED_COURSE_IDS:"blockedCourseIds"},ClearLocalStorage:function(){localStorage.removeItem(BLUE_MOODLE.localConstant.IS_USER_LOGEDIN_MOODLE);localStorage.removeItem(BLUE_MOODLE.localConstant.COURSE_TASK_LIST_MOODLE);localStorage.removeItem(BLUE_MOODLE.localConstant.COURSE_DETAILS_MOODLE);localStorage.removeItem(BLUE_MOODLE.localConstant.CUSTOM_SETTINGS_DETAILS_MOODLE);localStorage.removeItem(BLUE_MOODLE.localConstant.COURSE_BLOCKPOPUP_MOODLE);localStorage.removeItem(BLUE_MOODLE.localConstant.COURSE_TOOLDETAIL_LIST_MOODLE);localStorage.removeItem(BLUE_MOODLE.localConstant.CURRENT_COURSEID_MOODLE)},GetAdminSettingFromLocal:function(){return JSON.parse(localStorage.getItem(BLUE_MOODLE.localConstant.CUSTOM_SETTINGS_DETAILS_MOODLE))},getParameter:function(n){for(var i,r=window.location.search.substr(1).split("&"),t=0;t<r.length;t++)if(i=r[t].split("="),i[0]==n)return decodeURIComponent(i[1]);return!1},SetfocusOnPopup:function(){window.setTimeout("document.getElementById('bluePopupHeading').focus();",500)},CommonPopUp:function(n,t,i,r,u){var f="";return(t==null||t=="")&&(t=BLUE_MOODLE_SETUP.appAPI+"/Content/explorance-university.png"),f+='<div id="dvOuter" style="position: fixed; top: 0; left: 0; background: rgba(0,0,0,0.6); z-index: 1000; width: 100%; height: 100%;" role="dialog">',f+="<div id="+n+' style="position: relative; top: 25%; margin:auto; height: auto; max-width: 450px; width:auto; z-index: 10; background: #fff; border-top: 3px solid rgb(0, 153, 182); box-shadow: 0px 2px 6px rgba(0,0,0,1);" role="document" aria-live="assertive">',f+='<div style="padding: 0.5%; padding-bottom: 0;">',f+='<div style="text-align: center; box-shadow: lightGray 0px 1px; "><img height="72px" alt="Institution Logo Image" src='+t+' style="max-width:100%;" /><\/div>',f+='<h4 id="bluePopupHeading" style="padding: 10px;color: #444;font-size:13px; box-shadow: lightGray 0px 1px;text-align:center;" tabindex="0"><strong>'+i+"<\/strong><\/h4>",f+='<div style="padding:10px; max-height: 150px;overflow-y: auto;overflow-x: hidden;">',f+=u,f+="<\/div>",f+="<\/div>",f+='<div style="padding: 10px; background-color: #efede3; text-align: center">',f+=r,f+="<\/div>",f+="<\/div>",f+"<\/div>"},ClosePopup:function(n){var t;window.location.href.indexOf(BLUE_MOODLE_SETUP.moodleAPI+"/course/view.php?id=")>-1&&BLUE_MOODLE.CloseCoursePopup();n!=undefined&&n!=null&&n!=""?(t=document.getElementById(n),t.parentNode.removeChild(t)):(t=document.getElementById("dvOuter"),t.parentNode.removeChild(t))},CloseCoursePopup:function(){setTimeout("window.location.href = BLUE_MOODLE_SETUP.moodleAPI;",100)},ShowLoader:function(n){var r="Checking for incomplete evaluations",t,i;n=="admin"&&(r="Loading admin settings");t="";t+="<style> ";t+="#dvCanvasLoader {position: fixed;    top: 0;\tleft: 0;width: 100%;height: 100%;background: rgba(0,0,0,0.5);z-index:999999;} ";t+=".loaderMsg {width: 300px;\tposition: relative;overflow: hidden;left: 40%;top: 40%;text-align: center;font-size: 14px;color: #fff;font-family: Verdana, Geneva, sans-serif;} ";t+="@media screen and (-webkit-min-device-pixel-ratio:0){  .spinner div { width: 20px;height: 20px;position: absolute;left: -20px;top: 310px !important;background-color: #fff;border-radius: 50%;animation: move 4s infinite cubic-bezier(.2, .64, .81, .23);z-index: 9999; }} ";t+=".spinner div{width: 20px;\theight: 20px;position: absolute;left: -20px;top: 280px;background-color: #fff;border-radius: 50%;animation: move 4s infinite cubic-bezier(.2, .64, .81, .23);z-index: 9999;}";t+=".spinner div:nth-child(2){animation-delay: 100ms;}";t+=".spinner div:nth-child(3){animation-delay: 200ms;}";t+=".spinner div:nth-child(4){animation-delay: 300ms;}";t+="@keyframes move { 0% {left: 0%;} 75% {left:100%;} 100% {left:100%;}}";t+="<\/style>";t+='<div id="dvCanvasLoader"><div class="loaderMsg">'+r+"<\/div>";t+='<div class="spinner"><div><\/div><div><\/div><div><\/div><div><\/div><\/div>';t+="<\/div>";i=document.createElement("div");i.id="dvBlueLoader";i.innerHTML=t;document.body.appendChild(i)},HideLoader:function(){var n=document.getElementById("dvCanvasLoader");n!=null&&n!=""&&n.parentNode.removeChild(n)},NavigateToTask:function(n){var t='<div role="main"><iframe allowfullscreen="true" style="min-height: 650px;width:100%;" class="tool_launch" id="tool_content" mozallowfullscreen="true" name="tool_content" src="'+n+'" tabindex="0" title="Tool Content" webkitallowfullscreen="true"><\/iframe><\/div>';document.getElementById("region-main")!=null&&document.getElementById("region-main")!=""&&(document.getElementById("block-region-side-pre")!=null&&document.getElementById("block-region-side-pre")!=""&&(document.getElementById("block-region-side-pre").style.width="25%"),document.getElementById("page-content")!=null&&document.getElementById("page-content")!=""&&(document.getElementById("page-content").style.width="100%"),document.getElementById("region-main-box")!=null&&document.getElementById("region-main-box")!=""&&(document.getElementById("region-main-box").style.width="100%"),document.getElementById("region-bs-main-and-pre")!=null&&document.getElementById("region-bs-main-and-pre")!=""&&(document.getElementById("region-bs-main-and-pre").style.width="100%"),document.getElementById("block-region-side-post")!=null&&document.getElementById("block-region-side-post")!=""&&(document.getElementById("block-region-side-post").style.display="none"),document.getElementById("region-main").style.width="74%",document.getElementById("region-main").innerHTML=t);BLUE_MOODLE.ClosePopup("dvOuter")},PopUpCourseClick:function(n){window.location.href=n},AddLogoutEvents:function(){var r=document.getElementsByClassName("usermenu"),t,n;if(r!=null&&r.length>0&&(n=r[0].getElementsByTagName("a"),n!=null&&n!=""&&n.length>0))for(i=0;i<n.length;i++)n[i].href.indexOf("login")>-1&&(n[i].onclick=function(){BLUE_MOODLE.ClearLocalStorage()});if(t=document.getElementsByClassName("logininfo"),t!=null&&t!="")for(i=0;i<t.length;i++)if(n=t[i].getElementsByTagName("a"),n!=null&&n!=""&&n.length>0)for(j=0;j<n.length;j++)n[j].href.indexOf("login")>-1&&(n[j].onclick=function(){BLUE_MOODLE.ClearLocalStorage()})},BlockOtherLinksInCourse:function(){var r=document.getElementById("block-region-side-pre"),u=BLUE_MOODLE.GetAdminSettingFromLocal(),i,n,t;if(r!=null)if(i=r.querySelectorAll("a[href='"+BLUE_MOODLE_SETUP.moodleAPI+"/course/view.php?id="+localStorage.getItem(BLUE_MOODLE.localConstant.CURRENT_COURSEID_MOODLE)+"']"),i!=null&&i.length>0){if(n=i[0].parentElement.parentElement.getElementsByTagName("a"),n!=null&&n.length>0)for(t=0;t<n.length;t++)n[t].innerText.toLowerCase()!=u.ToolName.toLowerCase()&&(n[t].onclick=function(){return BLUE_MOODLE.DisableOnClickInternal()},n[t].href="javascript:void(0);")}else if(i=r.querySelectorAll("a[href='"+BLUE_MOODLE_SETUP.moodleAPI+"/course/view.php?id="+localStorage.getItem(BLUE_MOODLE.localConstant.CURRENT_COURSEID_MOODLE)+"']"),i!=null&&i.length>0&&(n=i[0].parentElement.parentElement.getElementsByTagName("a"),n!=null&&n.length>0))for(t=0;t<n.length;t++)n[t].innerText.toLowerCase()!=u.ToolName.toLowerCase()&&(n[t].onclick=function(){return BLUE_MOODLE.DisableOnClickInternal()},n[t].href="javascript:void(0);")},DisableOnClickInternal:function(n){var t="",r,i;if(t=n?window.location.href.indexOf("/course/view.php?id=")>-1?localStorage.getItem(BLUE_MOODLE.localConstant.COURSE_BLOCKPOPUP_MOODLE):"":localStorage.getItem(BLUE_MOODLE.localConstant.COURSE_BLOCKPOPUP_MOODLE),t!=undefined&&t!=null&&t!="")for(r=BLUE_MOODLE.htmlToElements(t),i=0;i<r.length;i++)document.body.appendChild(r[i])},htmlToElements:function(n){var t=document.createElement("template");return t.innerHTML=n,"content"in document.createElement("template")?t.content.childNodes:t.childNodes},GetTasksForCourseBlock:function(n,t,i){var r=new XMLHttpRequest;return r.open("GET",BLUE_MOODLE_SETUP.appAPI+"/api/Moodle/GetSeriousTaskDetails?studentID="+n+"&courseIDs="+t+"&language="+i+"&isLoginPopup=false",!1),r.setRequestHeader("Accept","application/json"),r.setRequestHeader("CONSUMERID",BLUE_MOODLE_SETUP.consumerID),r.send(),JSON.parse(r.response)},CreateCourseBlockPopup:function(n){var f=!1,t,i,u,r,e,o;if(window.location.href.indexOf("mod/lti/view.php?id=")>-1&&(n=null,f=!0,t=JSON.parse(localStorage.getItem(BLUE_MOODLE.localConstant.COURSE_TOOLDETAIL_LIST_MOODLE)),t!=null&&t.length>0))for(i=0;i<t.length;i++)if(t[i].ToolUrl==window.location.href){n=t[i].CourseId;break}return localStorage.setItem(BLUE_MOODLE.localConstant.CURRENT_COURSEID_MOODLE,n),u=localStorage.getItem(BLUE_MOODLE.localConstant.USER_DETAILS_MOODLE),u!=null&&n!=null?(r=document.getElementsByClassName("type_siteadmin"),e=document.getElementsByTagName("html")[0].getAttribute("lang"),r!=undefined&&r!=null&&r!=[]&&r.length>0||f||BLUE_MOODLE.ShowLoader("student"),o=BLUE_MOODLE.GetTasksForCourseBlock(u,n,e),BLUE_MOODLE.HideLoader(),BLUE_MOODLE.PrepareCourseBlockHTML(o.MoodleSeriousTaskList)):""},PrepareCourseBlockHTML:function(n){var t,u;if(n!=undefined&&n!=null&&n.length>0){var f=document.getElementsByTagName("html")[0].getAttribute("lang"),i=BLUE_MOODLE.GetAdminSettingFromLocal(),r='<table style="font-size:13px;width:100%" role="presentation">';for(t=0;t<n.length;t++){var e=new Date(n[t].DueDate+"Z"),o=e.toLocaleDateString(f,BLUE_MOODLE.localConstant.DATE_FORMAT),s=n[t].Name.length>32?n[t].Name.substring(0,35)+"...":n[t].Name;r+='<tr><td style="width:250px;"><a title = "'+n[t].Name+'" style="cursor:pointer;color:#0099b6;text-decoration:underline;" ';r+=i.LaunchNewTab?'href="'+n[t].Link+'" target="_blank" onclick="BLUE_MOODLE.CloseCoursePopup();">':'href="#" onclick="BLUE_MOODLE.NavigateToTask(\''+n[t].Link+"');\" >";r+=s+'<\/a><\/td><td style="text-align:right;"> '+i.DueLabel+" "+o+"<\/td><\/tr>"}return r+="<\/table>",u="",u+='<div style="text-align:center;">',u+='<input type="button" value="'+i.BlockingButtonLabel+'" title="'+i.BlockingButtonLabel+'" style="white-space: normal;" onclick="BLUE_MOODLE.CloseCoursePopup();" id="btnDoneLater"  />',u+="<\/div>",BLUE_MOODLE.CommonPopUp("dvPending_Task",i.LogoURL,i.BlockingMessage,u,r)}return""},getQueryString:function(n,t){var r=new RegExp("[?&]"+n+"=([^&#]*)","i"),i=r.exec(t);return i?i[1]:null},GetBlockedCoursIds:function(){var n=localStorage.getItem(BLUE_MOODLE.localConstant.BLOCKED_COURSE_IDS);return n!=null&&n!=""?n.split(","):null},ShowBlockForHomepageCourses:function(n){var t=JSON.parse(localStorage.getItem(BLUE_MOODLE.localConstant.COURSE_TASK_LIST_MOODLE)),i;t!=null&&(t=t.filter(function(t){return t.CourseID==n.getAttribute("bluecourseid")}),t!=null&&t.length>0&&(i=BLUE_MOODLE.PrepareCourseBlockHTML(t),BLUE_MOODLE.AppendHtmlToBody(i)))},BlockHomepageCourses:function(){var t=document.querySelectorAll(".block_navigation"),i,r,u;if(t!=null&&t.length>0&&(i=JSON.parse(localStorage.getItem(BLUE_MOODLE.localConstant.COURSE_DETAILS_MOODLE)),i!=null&&(r=i.map(function(n){return n.id}),u=localStorage.getItem(BLUE_MOODLE.localConstant.USER_DETAILS_MOODLE),u!=null&&r!=null))){var f=document.getElementsByTagName("html")[0].getAttribute("lang"),e=t[0].getElementsByTagName("a"),n=BLUE_MOODLE.GetTasksForCourseBlock(u,r,f);n!=null&&n.MoodleSeriousTaskList&&n.MoodleSeriousTaskList.length>0&&(localStorage.setItem(BLUE_MOODLE.localConstant.COURSE_TASK_LIST_MOODLE,JSON.stringify(n.MoodleSeriousTaskList)),localStorage.setItem(BLUE_MOODLE.localConstant.BLOCKED_COURSE_IDS,n.MoodleSeriousTaskList.map(function(n){return n.CourseID})),BLUE_MOODLE.AddEventToLinks(e))}},AddEventToLinks:function(n){for(i=0;i<n.length;i++)if(n[i].href.search("course/index.php")>1||n[i].href.search("courses.php")>1||n[i].href.search("course/view.php")>1)if(n[i].href.search("course/view.php")>1&&n[i].parentElement!=null&&n[i].parentElement.getAttribute("bcevents")==null){var t=BLUE_MOODLE.getQueryString("id",n[i].href),r=BLUE_MOODLE.GetBlockedCoursIds();r!=null&&r.indexOf(t.toString())!=-1&&(n[i].style.color="#ccc",n[i].style.cursor="not-allowed",n[i].style.textDecoration="none !important",n[i].style.pointerEvents="none",n[i].href="javascript:void(0);",n[i].parentElement.setAttribute("bcevents","1"),n[i].parentElement.setAttribute("disabled","disabled"),n[i].parentElement.setAttribute("bluecourseid",t),n[i].parentElement.removeAttribute("data-requires-ajax"),n[i].parentElement.onclick=function(n){return BLUE_MOODLE.ShowBlockForHomepageCourses(this),n.preventDefault(),n.stopPropagation(),!1},n[i].parentElement.parentElement!=null&&(n[i].parentElement.parentElement.removeAttribute("data-requires-ajax"),n[i].parentElement.parentElement.setAttribute("disabled","disabled"),n[i].parentElement.parentElement.setAttribute("bluecourseid",t),n[i].parentElement.parentElement.onclick=function(n){return BLUE_MOODLE.ShowBlockForHomepageCourses(this),n.preventDefault(),n.stopPropagation(),!1}))}else n[i].parentElement!=null&&n[i].parentElement.getAttribute("bcevents")==null&&(n[i].parentElement.addEventListener("click",function(n){window.setTimeout(function(){BLUE_MOODLE.AddEventToChild(n.target)},1e3)}),n[i].parentElement.addEventListener("keydown",function(n){window.setTimeout(function(){BLUE_MOODLE.AddEventToChild(n.target)},1e3)}),n[i].parentElement.setAttribute("bcevents","1"),n[i].parentElement.setAttribute("title","Course blocked due to pending tasks.")),n[i].parentElement.parentElement!=null&&n[i].parentElement.parentElement.getAttribute("bcevents")==null&&(n[i].parentElement.parentElement.addEventListener("click",function(n){window.setTimeout(function(){BLUE_MOODLE.AddEventToChild(n.target)},1e3)}),n[i].parentElement.parentElement.addEventListener("keydown",function(n){window.setTimeout(function(){BLUE_MOODLE.AddEventToChild(n.target)},1e3)}),n[i].parentElement.parentElement.setAttribute("bcevents","1"),n[i].parentElement.setAttribute("title","Course blocked due to pending tasks."))},AddEventToChild:function(n){var t;t=n.parentElement!=null&&n.parentElement!=undefined?n.parentElement.getElementsByTagName("a"):n.getElementsByTagName("a");BLUE_MOODLE.AddEventToLinks(t)},AppendHtmlToBody:function(n){var t=document.createElement("div");t.id="dvBlueTasksPrompt";t.innerHTML=n;document.body.appendChild(t);BLUE_MOODLE.SetfocusOnPopup()},GetTasksForLoginPopup:function(n,t){var i=new XMLHttpRequest;i.open("GET",BLUE_MOODLE_SETUP.appAPI+"/api/Moodle/GetSeriousTaskDetails?studentID="+n+"&courseIDs=&language="+t+"&isLoginPopup=true",!0);i.setRequestHeader("Accept","application/json");i.setRequestHeader("CONSUMERID",BLUE_MOODLE_SETUP.consumerID);i.onreadystatechange=function(){var n,s,e,h,c;if(i.readyState==4&&i.status==200&&(n=JSON.parse(i.response),n!=null)){var l=!1,f=[],o=[],u=BLUE_MOODLE.GetAdminSettingFromLocal();if(n.MoodleSeriousTaskList!=null&&n.MoodleSeriousTaskList.length>0&&(f=n.MoodleSeriousTaskList,localStorage.setItem(BLUE_MOODLE.localConstant.COURSE_TASK_LIST_MOODLE,JSON.stringify(f))),n.MoodleCourseDetails!=null&&n.MoodleCourseDetails.length>0&&(o=n.MoodleCourseDetails,localStorage.setItem(BLUE_MOODLE.localConstant.COURSE_DETAILS_MOODLE,JSON.stringify(o))),n.MoodleCourseToolDetailList!=null&&n.MoodleCourseToolDetailList.length>0&&localStorage.setItem(BLUE_MOODLE.localConstant.COURSE_TOOLDETAIL_LIST_MOODLE,JSON.stringify(n.MoodleCourseToolDetailList)),u.IsLoginPrompt){var r={Ids:[],PopUpList:[]},a=!1,v=!1;if(f.length>0){l=!0;function y(i){for(var h,c,l,y=!1,e=0;e<r.Ids.length;e++)if(i.CourseID==r.Ids[e]){y=!0;break}if(!y){for(r.Ids.push(i.CourseID),h=[],e=0;e<o.length;e++)if(o[e].id==i.CourseID){h.push(o[e]);break}for(c=[],e=0;e<f.length;e++)f[e].CourseID==i.CourseID&&c.push(new Date(f[e].DueDate+"Z"));if(l="",n.MoodleCourseToolDetailList!=null&&n.MoodleCourseToolDetailList.length>0)for(e=0;e<n.MoodleCourseToolDetailList.length;e++)if(n.MoodleCourseToolDetailList[e].CourseId==i.CourseID){l=n.MoodleCourseToolDetailList[e].ToolUrl;break}var s={CourseId:i.CourseID,Course:h,ToolUrl:l,DueDates:c},w=new Date(Math.min.apply(null,s.DueDates)),p=w.toLocaleDateString(t,BLUE_MOODLE.localConstant.DATE_FORMAT);s.Course.length>0?r.PopUpList.push({CourseName:s.Course[0].fullname,ToolUrl:s.ToolUrl,DueDate:p,CourseID:s.Course[0].id}):!a&&u.UserLevelTasks&&(a=!0,r.PopUpList.push({CourseName:u.OtherTaskLabel,ToolUrl:s.ToolUrl,DueDate:p,CourseID:"0"}));i.TaskType!="FO"&&(v=!0)}}f.forEach(y)}if(l&&r.PopUpList.length>0){if(s="",r.PopUpList.length>0){for(s+='<table style="font-size:13px;width:100%" role="presentation">',e=0;e<r.PopUpList.length;e++)s+='<tr><td style="width:250px;"><a style="cursor:pointer;color:#0099b6;text-decoration:underline;" href="#" title="'+r.PopUpList[e].CourseName+'" onclick="BLUE_MOODLE.PopUpCourseClick(\''+r.PopUpList[e].ToolUrl+"');\" >"+r.PopUpList[e].CourseName+'<\/a><\/td><td style="text-align:right;"> '+u.DueLabel+" "+r.PopUpList[e].DueDate+"<\/td><\/tr>";s+="<\/table>"}h="";r.PopUpList.length>0&&(h+='<div style="text-align:right;">',h+='<input type="button" value="'+u.LoginButtonLabel+'" title="'+u.LoginButtonLabel+'" style="white-space: normal;" onclick="BLUE_MOODLE.ClosePopup();"  id="btnPendingOk"  />',h+="<\/div>");c=BLUE_MOODLE.CommonPopUp("dvInner_SeriousTask",u.LogoURL,v?u.QPSVMHeaderText:u.LoginMessage,h,s);BLUE_MOODLE.AppendHtmlToBody(c);BLUE_MOODLE.AddLogoutEvents()}}else window.location.href.toLowerCase().indexOf("/course/view.php?id=")>-1&&u.GradeCourseBlockType=="CB"&&(c=BLUE_MOODLE.CreateCourseBlockPopup(BLUE_MOODLE.getParameter("id")),BLUE_MOODLE.AppendHtmlToBody(c));u.GradeCourseBlockType=="CB"&&BLUE_MOODLE.BlockHomepageCourses()}};i.send()}};(document.referrer.toLowerCase().indexOf("login/index.php")!=-1||window.location.href.toLowerCase().indexOf("login/index.php")!=-1||window.location.href.toLowerCase().indexOf("login.php")!=-1||document.referrer!=""&&document.referrer.toLowerCase().indexOf(window.location.host)==-1)&&BLUE_MOODLE.ClearLocalStorage();window.addEventListener?window.addEventListener("load",BlueMoodleOnload,!1):window.attachEvent?window.attachEvent("onload",BlueMoodleOnload):window.onload=BlueMoodleOnload;